<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/css/template_w.css"/>
    <link rel="stylesheet" href="/css/stylemy.css">
    <link href="https://webfontworld.github.io/gmarket/GmarketSans.css" rel="stylesheet">
    <!--    폰트-->
</head>
<style>
    table {
        width: 80%;
        margin: 20px auto;
        border-collapse: collapse;
    }

    th, td {
        border: 1px solid #ddd;
        padding: 10px;
    }

    th {
        background-color: #f2f2f2;
        width: 200px;
        text-align: center;
    }

    .title {
        font-size: 24px;
        font-weight: bold;
        text-align: center;
    }

    .author {
        font-size: 18px;
        text-align: center;
    }

    .content {
        font-size: 16px;
        padding: 20px;
    }

    .comment-section {
        width: 80%;
        margin: 20px auto;
        border: 1px solid #ccc; /* 테두리 추가 */
        padding: 10px;
        border-radius: 5px;
    }

    .comment {
        margin-bottom: 20px; /* 댓글 사이에 간격 추가 */
    }

    .comment:not(:last-child) {
        border-bottom: 1px solid #ccc; /* 댓글 사이에 구분선 추가 */
        padding-bottom: 10px;
    }

    .comment:last-child {
        margin-bottom: 0;
    }

    .comment-header {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .comment-buttons {
        margin-top: 5px;
    }

    .comment-buttons button {
        margin-right: 5px;
        background-color: #a69837;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
    }

    .comment-buttons button:hover {
        background-color: #45a049;
    }

    /*가운데 정렬 스타일 추가 */
    .center {
        text-align: center;
    }

    /* 버튼 스타일 정의 */
    .button {
        display: inline-block;
        background-color: #777577;
        color: white;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 10px;

    }

    /* 버튼 호버 효과 */
    .button:hover {
        background-color: #525252;
    }

    /* 답글 달기 버튼 스타일 */
    .reply-button {
        background-color: #e1c06e;
        border: none;
        color: white;
        padding: 5px 10px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 12px;
        margin-left: 10px;
        border-radius: 5px;
    }

    /* 답글 달기 버튼 호버 효과 */
    .reply-button:hover {
        background-color: #004455;
    }

    /* 댓글 입력 폼 스타일 */
    .comment-form {
        width: 80%;
        margin: 20px auto;
    }

    .comment-input {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        resize: none;
    }

    .submit-button {
        background-color: #777577;
        color: white;
        padding: 10px 20px;
        text-align: center;

        text-decoration: none;
        font-size: 16px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    /* 답글 폼 스타일 */
    .reply-form {
        margin-left: 50px;
    }
</style>


<body>
<div id="wrap">
    <header>

    </header>
    <nav>
        <div id="nav" class="container">
            <div class="nav_inner">
                <div class="nav__logo">
                    <a href="/home">WEB <em>소설</em></a>
                </div>
                <div class="nav__search">
                    <input type="text" class="search" value="작가명">
                    <button class="sch_btn" type="submit">보내기</button>
                </div>
                <div class="nav__manu">
                    <ul>
                        <li><a href="#" id="red">월간 베스트</a></li>
                        <li><a href="#">ALL</a></li>
                        <li><a href="/board">리뷰 </a></li>
                        <!--                        <li><a href="#">리뷰 </a></li>-->
                        <!--                        <li><a href="#">나도 작가</a></li>-->
                        <li><a href="#">MY</a></li>
                        <li><a href="#">공지 사항</a></li>
                    </ul>
                </div>
                <div class="nav__member">
                    <!--                    <a href="#">로그인</a>-->
                    <input type="checkbox" id="menuicon"/>
                    <label for="menuicon">
                        <span></span>
                        <span></span>
                        <span></span>
                    </label>
                    <div class="sidebar">
                        <!--                    사이드바-->
                        <div class="sidebar_cont1">
                            <a href="#">로그인</a>

                        </div>
                        <div class="sidebar_cont2">ee</div>
                        <div class="sidebar_cont3">ee</div>
                        <div class="sidebar_cont4">ee</div>
                        <div class="sidebar_cont5">ee</div>




                    </div>
                </div>
            </div>

        </div>
    </nav>
    <main>

        <div class="contents container">
<!--///////////////////////////////////////////////-->

            <div class="board_wrap">
                <div class="board_title">
                    <strong>리뷰</strong>
                    <p> 욕설과 비속어는 자제 부탁드립니다.</p>
                </div>
                <div class="board_view_wrap">
                    <div class="board_view">
                        <div class="title">
                            <%=detail_contttt.title%>
                        </div>
                        <div class="info">
                            <dl>
                                <dt>번호</dt>
                                <dd> <%=detail_contttt.id%>   </dd>
                            </dl>
                            <dl>
                                <dt>글쓴이</dt>
                                <dd>유저<%=detail_contttt.author%></dd>
                            </dl>
                                            <dl>
                                                <dt>작성일</dt>
                                                <dd><%=detail_contttt.date%></dd>
                                            </dl>
                            <!--                <dl>-->
                            <!--                    <dt>조회</dt>-->
                            <!--                    <dd>33</dd>-->
                            <!--                </dl>-->
                        </div>
                        <div class="cont">
                            <%=detail_contttt.contents%><br>


                        </div>
                    </div>
                    <div class="bt_wrap1">
<!--                        <a href="/board" class="on">목록</a>-->
<!--                        <a href="/edit/<%=detail_contttt.id%>">수정</a>-->
<!--                        <a href="/deletegogo/<%= detail_contttt.id %>" class="on">삭제</a>-->
<!--                        삭제 추가함-->


<!--                        <form action="/addComment?id=<%=detail_contttt.id%>" method="POST">-->
<!--                            <label for="content">댓글 내용:</label><br>-->
<!--                            <textarea id="content" name="content" rows="5" required></textarea><br>-->
<!--                           <input type="submit" value="댓글 추가">-->
<!--                        </form>-->
                        <div class="comment-section">
                            <div class="comment-header">댓글</div>
                            <% if (comments && comments.length > 0) { %>
                                <% comments.forEach(comment => { %>
                                    <div class="comment">
                                        <p><%= comment.author %>
                                            <% if (comment.author_id == userId) { %>
                                                (본인)
                                            <% } %>
                                            &nbsp<%= comment.created_at %>
                                        </p>
                                        <!--  HTML
                                        data- : HTML 사용자 정의 데이터 속성을 정의
                                        이것은 아래 규칙이 적용.
                                        > 'data-' prefix로 되어 나머지 텍스트를 사용하여 사용자 정의 데이터 값을 참조할 수 있다. data-comment-id => comment-id
                                        > -으로 연결된 단어는 카멜규칙을 적용한다.  comment-id => commentId
                                        이후 제이쿼리 data함수에서 commentID로 정의된 값을 참조할 수 있다.
                                        -->
                                        <p class="comment-content" data-comment-id="<%= comment.id %>"><%= comment.content %></p> <!-- 여기서 '.comment-content'를 추가했습니다. -->
                                        <div class="comment-buttons">
                                            <a href="#" class="reply-button" data-comment-id="<%= comment.id %>">답글쓰기</a>
                                            <% if (comment.author_id == userId) { %> <!-- 작성자 본인의 댓글일 경우 -->
                                            <button class="edit-button" data-comment-id="<%= comment.id %>">수정</button> <!-- 'data-comment-id' 속성 추가 -->
                                            <form action="/deleteComment/<%= comment.id %>" method="POST" style="display: inline;">
                                                <input type="hidden" name="post_id" value="<%= detail_contttt.id %>">
                                                <button type="submit">삭제</button>
                                            </form>
                                            <% } %>
                                        </div>
                                        <% if (comment.children && comment.children.length > 0) { %>

                                            <% comment.children.forEach(childComment => { %>
                                                <div class="comment reply-form">
                                                    <p><%= childComment.author %>
                                                        <% if (childComment.author_id == userId) { %>
                                                            (본인)
                                                        <% } %>
                                                        &nbsp<%= childComment.created_at %>
                                                    </p>
                                                    <p class="comment-content" data-comment-id="<%= childComment.id %>"><%= childComment.content %></p> <!-- 여기서 '.comment-content'를 추가했습니다. -->
                                                    <div class="comment-buttons">
                                                        <a href="#" class="reply-button" data-comment-id="<%= comment.id %>">답글쓰기</a>
                                                        <% if (childComment.author_id == userId) { %> <!-- 작성자 본인의 댓글일 경우 -->
                                                        <button class="edit-button" data-comment-id="<%= childComment.id %>">수정</button> <!-- 'data-comment-id' 속성 추가 -->
                                                        <form action="/deleteComment/<%= childComment.id %>" method="POST" style="display: inline;">
                                                            <input type="hidden" name="post_id" value="<%= detail_contttt.id %>">
                                                            <button type="submit">삭제</button>
                                                        </form>
                                                        <% } %>
                                                    </div>
                                                    </p>
                                                </div>
                                            <% }); %>
                                        <% } %>
                                    </div>
                                <% }); %>
                            <% } else { %>
                                <p>댓글이 없습니다.</p>
                            <% } %>
                        </div>

                        <div class="comment-form">
                            <form action="/addComment" method="POST">
                                <textarea class="comment-input" name="content" rows="5" placeholder="'<%= detail_contttt.author%>'님 댓글을 남겨보세요" required></textarea><br>
                                <input type="hidden" name="post_id" value="<%= detail_contttt.id %>">
                                <input type="hidden" name="author_id" value="<%= detail_contttt.author %>">
                                <input type="submit" value="등록" class="submit-button">
                            </form>
                        </div>
                        <!-- 이전 페이지로 돌아가기 버튼 -->
                        <div class="center">
<!--                            <a href="/boardMain" class="button">이전 페이지로 돌아가기</a>-->
<!--                            <a href="/editPost/<%= detail_contttt.id %>" class="button">수정</a>-->
<!--                            <a href="/deletePost/<%=detail_contttt.id %>" class="button">삭제</a>-->
                            <a href="/board" class="button">이전 페이지로 돌아가기</a>
                            <a href="/edit/<%=detail_contttt.id%>" class="button" >수정</a>
                            <a href="/deletegogo/<%= detail_contttt.id %>" class="button">삭제</a>
                        </div>


                    </div>
                </div>
            </div>


            <script src="/js/jquery.js"></script>
            <script>
                $(document).ready(function() {
                    // 답글쓰기 버튼 클릭 시 해당 댓글 아래에 답글 입력 폼을 표시하는 함수
                    $('.reply-button').click(function(e) {
                        e.preventDefault();
                        const commentId = $(this).data('commentId');
                        // closest: 현재 클릭된 요소 중 가장 가까운 부모 요소를 찾는 메소드
                        // closest('.comment-buttons') 가장 가까운 요소중 클래스가 .comment-buttons
                        // 인 요소를 찾아 반환
                        const replyForm = $(this).closest('.comment-buttons').find('.reply-form');
                        if (replyForm.length === 0) {
                            const newReplyForm = `
                    <div class="comment reply-form">
                        <form action="/addComment" method="POST">
                            <input type="hidden" name="post_id" value="<%=detail_contttt.id %>">
                            <input type="hidden" name="author_id" value="<%=  detail_contttt.author %>">
                            <input type="hidden" name="comment_id" value="${commentId}">
                            <textarea class="comment-input" name="content" rows="3" placeholder="'<%=  detail_contttt.author%>'님 답글을 남겨보세요" required></textarea><br>
                            <input type="submit" value="등록" class="submit-button">
                        </form>
                    </div>`;
                            $(this).closest('.comment').append(newReplyForm);
                        }
                    });

                    // '수정' 버튼 클릭 시 해당 댓글의 수정 화면을 동적으로 생성
                    $(document).on('click', '.edit-button', function(e) {
                        e.preventDefault();
                        const commentArea = $(this).closest('.comment');
                        const commentId = $(this).data('commentId');
                        const existingForm = commentArea.find('.edit-form');
                        if (existingForm.length === 0) {
                            const commentContent = commentArea.find(`.comment-content[data-comment-id="${commentId}"]`).text().trim();
                            // 수정후 상세 페이지 리다이렉시시 필요한 게시글 id를 지정
                            const postId = '<%=detail_contttt.id %>'; // 게시물 ID 가져오기
                            const editForm = `
                    <div class="comment edit-form">
                        <form action="/editComment/${commentId}" method="POST">
                            <textarea class="comment-input" name="content" rows="3" placeholder="댓글 수정 내용을 입력하세요" required>${commentContent}</textarea><br>
                            <input type="hidden" name="post_id" value="${postId}"> <!-- 게시물 ID hidden으로 추가 -->
                            <input type="submit" value="수정 완료" class="submit-button">
                        </form>
                    </div>`;
                            commentArea.append(editForm);
                        }
                    });
                });
            </script>




<!--    ///////////////////////////////////////        -->
        </div>

    </main>
    <footer>
        <div class="container"></div>
    </footer>
</div>

<script>
    window.onload = function(){

//스크롤이 내려가면 네비바가 고정되게
        window.addEventListener('scroll', function () {
            var nav = document.querySelector('nav');
            if (window.scrollY > 0) {
                nav.style.position = 'fixed';
                nav.style.top = '0';
                nav.style.width = '100%';
                // console.log('Scrolling!')
                // 스크롤 내리면 변할 모양

                nav.style.backgroundColor = 'rgb(255,255,255)';
                nav.style.borderBottom = '2px solid rgba(0, 0, 0, 0.3)';
                nav.style.borderTop = '2px solid rgba(0, 0, 0, 0.3)';
                nav.style.zIndex = '1000';
            } else {
                nav.style.position = 'static';

                // 다시 돌아오면 원상복구

                nav.style.backgroundColor = ''; // 기존 스타일로 복원하려면 비워둘 수 있습니다.
                // 필요에 따라 추가적인 스타일 속성을 여기에 추가할 수 있습니다.
            }
        });





    }

</script>

</body>
</html>